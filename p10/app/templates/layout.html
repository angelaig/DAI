<!DOCTYPE html>
<html>
    <head>
        <title>{% block title %}{% endblock %}</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
          <!-- Including Bootstrap CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    
        <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
         <!-------------------------------->
    
        <!--link to my local stylesheet-->
        <link rel="stylesheet" href="../static/style.css">


        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css">
        <link rel="stylesheet" href="../static/style.css">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">
        <link rel="icon" href="../static/favicon.png">
        <meta http-equiv="pragma" content="no-cache" />
        <meta http-equiv="expires" content="-1" />



        <!-------------------MAPA-->
        	


        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

          <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/>
          <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>


	<style>
		html, body {
			height: 100%;
			margin: 0;
		}
		#map {
			width: 600px;
			height: 400px;
		}
	</style>
        
    </head>
    <body>
        <!------------------------------>
  <header>

   
  


 <!-- Fixed navbar -->
 <nav class="navbar navbar-expand-lg navbar-light bg-secondary">  
   <!-- secondary = gris-->

      <!-------logos---------->
      
    <!--Imagen-->
        <a class="navbar-brand" href="#">
            <img src="/static/img/pokeball.webp" alt="" style="width:80px;height:80px;">
        </a> 
        <a class="navbar-brand" href="/">
          Pokémon
        </a>
   
    


      <div class="collapse navbar-collapse" id="navbarCollapse">
            
        <ul class="navbar-nav mr-auto">
 
       
          <li class="nav-item">
            <a class="nav-link" href="/p8">Mapa </a>
         </li>
         <li class="nav-item">
          <a class="nav-link" href="/modificar">Modificar</a>
          
       </li>
       <li class="nav-item">
        <a class="nav-link" href="/borrar">Borrar</a>
        
     </li>
     <li class="nav-item">
      <a class="nav-link" href="/registrar">Registrar</a>
     </li>

   
        </ul>
       

            
      </div>



      <!-------BUSCAR-->
      
      <form class="form-inline my-2 my-lg-0" action="/buscar" method="GET">
  
        <div class="form-group">
          <input type="number" name="id" class="form-control" placeholder="Numero Pokemon" required>
        </div>

        <button type="submit" class="btn btn-primary">Buscar</button>

       
      </form>

    

    </nav>
 
</header>




    <div class="container-fluid">
      <!------VERTICAL--MENU---->
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm">
        
       

        </div>
        <div class="col-sm">

          {% block body %}
          {% endblock %}
        </div>
        <div class="col-sm">
            <ul>
              
            </div>
         </ul>
          </div>
        </div>
      </div>
    </div>

    </div>


<footer class="footer">
  <div class="container">
    <span class="text-muted">Pokémon, since 1999</span>
  </div>
</footer>




    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
	  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js"></script>
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
	  <script>

 

function Deletepokemon(value, tipo) {
  // Para poner otra vez funciones jQuery en el DOM actual
  let urlApi = '/api/pokemon/' + value
  $(function () {
    console.log(urlApi) 
    $.ajax({
      url : urlApi,
      type : 'DELETE',
  });
  $( "tbody" ).empty();
  $.getJSON('/api/pokemon', { type : tipo }, function(resp) {


    markers.clearLayers();
        pokeIcons = []; 
        arr=[];


      $.each(resp, function(k, v) {
        arr.push([v['name'],v['img'],v['x'],v['y']]);
        $( "tbody" ).append(`<tr>
        <td>${v['name']}</td>
        <td>
          <center>
            <img src="${v['img']}" width=100px/></td>
          </center>
        <td>${v['type']}</td>
       
      <td> 
      <center>
        <a class="btn btn-primary btn-sm" onclick="Deletepokemon('${v.name}', '${tipo}')">Borrar</a>
      </center>
     
      </td>
      <td>${v['x']}</td>
        <td>${v['y']}</td>
      </tr>`)
    });
    

    

      
      for (var i = 0; i < arr.length; i++) {
        var pokeIconAux = new LeafIcon({iconUrl: arr[i][1]}); 
     
        pokeIcons.push(pokeIconAux);
        var marker= L.marker([arr[i][2], arr[i][3]], {icon: pokeIcons[i]}).bindPopup(arr[i][0]).addTo(map);
      
        markers.addLayer(marker);
      }

 
      

      map.addLayer(markers);
    
     }
    
    );
    $( "tbody" ).empty();
  });

}
	  

function blackmode() {
  $("#contenido").toggleClass("oscuro");

} 



   
var map = L.map('map').setView([51.5, -0.09], 13);
var markersLayer = new L.LayerGroup();

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

var LeafIcon = L.Icon.extend({
  options: {
    shadowUrl: '/static/img/leaf-shadow.png',
    iconSize:     [78, 95],
    shadowSize:   [50, 64],
    iconAnchor:   [22, 94],
    shadowAnchor: [4, 62],
    popupAnchor:  [-3, -76]
  }
});
var markers = new L.layerGroup();
var pokeIcons = []; 


$(document).ready(function(){
    var arr = [];
    $( "#search" )
    .keyup(function() {
      var value = $( this ).val();
      $( "#typeSearch" ).text( value );
      $( "tbody" ).empty();
      
     
      
      $.getJSON('/api/pokemon', { type : value }, function(resp) {
     
        markers.clearLayers();
        pokeIcons = []; 
        arr=[];
        $.each(resp, function(k, v) {


        arr.push([v['name'],v['img'],v['x'],v['y']]);
       
        console.log(arr.length) 
                $( "tbody" ).append(`<tr>
                <td>${v['name']}</td>
                <td>
                  <center>
                    <img src="${v['img']}" width=100px/></td>
                  </center>
                <td>${v['type']}</td>
              x
              <td> 
              <center>
                <a class="btn btn-primary btn-sm" onclick="Deletepokemon('${v.name}', '${value}')">Borrar</a>
              </center>
            
              </td>
              <td>${v['x']}</td>
                <td>${v['y']}</td>
              </tr>`) 

        
        }

      ); 
    

      console.log("CREO ICONO");
      for (var i = 0; i < arr.length; i++) {
        var pokeIconAux = new LeafIcon({iconUrl: arr[i][1]}); 
     
        pokeIcons.push(pokeIconAux);
        var marker= L.marker([arr[i][2], arr[i][3]], {icon: pokeIcons[i]}).bindPopup(arr[i][0]).addTo(map);
        console.log("CREO ICONO EN BUCLE ");
        markers.addLayer(marker);
      }

 
      

      map.addLayer(markers);
 
   });
    

    
  })
  .keyup();
});



  



	  </script>


</body>
</html>

